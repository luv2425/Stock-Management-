<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f4f4f4;
        }

        h1 {
            color: #096ae9
        }

        h2,
        h3 {
            color: #333
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
            background: #ffffff;
            padding: 14px 20px;
            border-radius: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 24px;
        }

        .nav a {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            text-decoration: none;
            font-weight: 600;
            color: #fff;
            padding: 8px 18px;
            border-radius: 999px;
            font-size: 15px;
            transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
        }

        .nav a.dashboard {
            background: #0d6efd;
        }

        .nav a.stock {
            background: #198754;
        }

        .nav a.billing {
            background: #ffc107;
            color: #000;
        }

        .nav a.reports {
            background: #dc3545;
        }

        .nav a:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.18);
            opacity: 0.95;
        }

        .nav a.active {
            box-shadow: 0 0 0 3px #ffffff, 0 0 0 5px rgba(0, 0, 0, 0.08);
        }

        .cards {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 20px;
        }

        .card {
            background: #ffffff;
            padding: 14px 18px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
            min-width: 180px;
            flex: 1;
        }

        .card h3 {
            margin: 0 0 6px;
            font-size: 14px;
            color: #555;
        }

        .card p {
            margin: 0;
            font-size: 20px;
            font-weight: bold;
            color: #222;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 12px;
            background: #fff;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left
        }

        th {
            background: #007bff;
            color: #fff
        }

        tr:nth-child(even) {
            background: #f9f9f9
        }

        .section {
            margin-top: 24px;
        }

        .chart-container {
            background: #fff;
            padding: 12px;
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);
        }
    </style>
</head>

<body>
    <div class="nav">
        <a href="dashboard.html" class="dashboard">ðŸ“Š Dashboard</a>
        <a href="stock.html" class="stock">ðŸ“¦ Stock</a>
        <a href="billing.html" class="billing">ðŸ§¾ Billing</a>
        <a href="reports.html" class="reports">ðŸ“ˆ Reports</a>
    </div>

    <h1>ðŸ“Š Dashboard</h1>

    <!-- Top summary cards -->
    <div class="cards">
        <div class="card">
            <h3>Total Products</h3>
            <p id="totalProducts">0</p>
        </div>
        <div class="card">
            <h3>Total Stock Quantity</h3>
            <p id="totalQuantity">0</p>
        </div>
        <div class="card">
            <h3>Total Stock Value</h3>
            <p id="totalStockValue">â‚¹0.00</p>
        </div>
        <div class="card">
            <h3>Today's Sales</h3>
            <p id="todaySales">â‚¹0.00</p>
        </div>
        <div class="card">
            <h3>Today's Profit</h3>
            <p id="todayProfit">â‚¹0.00</p>
        </div>
    </div>

    <!-- Sales last 7 days chart -->
    <div class="section">
        <h2>Sales - Last 7 Days</h2>
        <div class="chart-container">
            <canvas id="salesChart" height="120"></canvas>
        </div>
    </div>

    <!-- Low stock table -->
    <div class="section">
        <h2>Low Stock Items (below 50)</h2>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Category</th>
                    <th>Quantity</th>
                    <th>Unit</th>
                </tr>
            </thead>
            <tbody id="lowStockBody">
            </tbody>
        </table>
    </div>

    <!-- Recent sales -->
    <div class="section">
        <h2>Recent Sales</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Items Count</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="recentSalesBody">
            </tbody>
        </table>
    </div>

    <script>
        const STORAGE_KEYS = {
            PRODUCTS: 'sbm_products',
            SALES: 'sbm_sales'
        };

        function loadProducts() {
            try { return JSON.parse(localStorage.getItem(STORAGE_KEYS.PRODUCTS)) || []; }
            catch (e) { return []; }
        }

        function loadSales() {
            try { return JSON.parse(localStorage.getItem(STORAGE_KEYS.SALES)) || []; }
            catch (e) { return []; }
        }

        function formatCurrency(v) { return "â‚¹" + Number(v).toFixed(2); }

        function initDashboard() {
            const products = loadProducts();
            const sales = loadSales();

            const totalProducts = products.length;
            const totalQuantity = products.reduce((sum, p) => sum + Number(p.quantity || 0), 0);
            const totalStockValue = products.reduce(
                (sum, p) => sum + Number(p.quantity || 0) * Number(p.price || 0),
                0
            );

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalQuantity').textContent = totalQuantity;
            document.getElementById('totalStockValue').textContent = formatCurrency(totalStockValue);

            const todayStr = new Date().toDateString();
            let todaySalesTotal = 0;
            let todayProfitTotal = 0;

            sales.forEach(s => {
                const d = new Date(s.date);
                if (d.toDateString() === todayStr) {
                    todaySalesTotal += Number(s.total || 0);
                    todayProfitTotal += Number(s.total || 0) - Number(s.cost || 0);
                }
            });

            document.getElementById('todaySales').textContent = formatCurrency(todaySalesTotal);
            document.getElementById('todayProfit').textContent = formatCurrency(todayProfitTotal);

            const lowStockBody = document.getElementById('lowStockBody');
            lowStockBody.innerHTML = "";
            const lowItems = products.filter(p => Number(p.quantity || 0) < 50);

            if (lowItems.length === 0) {
                lowStockBody.innerHTML = "<tr><td colspan='4' style='text-align:center'>No low stock items</td></tr>";
            } else {
                lowItems.forEach(p => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
            <td>${p.name}</td>
            <td>${p.category}</td>
            <td>${p.quantity}</td>
            <td>${p.unit}</td>
          `;
                    lowStockBody.appendChild(tr);
                });
            }

            const recentSalesBody = document.getElementById('recentSalesBody');
            recentSalesBody.innerHTML = "";
            const sortedSales = [...sales].sort((a, b) => new Date(b.date) - new Date(a.date));
            const recent = sortedSales.slice(0, 5);

            if (recent.length === 0) {
                recentSalesBody.innerHTML = "<tr><td colspan='4' style='text-align:center'>No sales yet</td></tr>";
            } else {
                recent.forEach(s => {
                    const d = new Date(s.date);
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
            <td>${d.toLocaleString()}</td>
            <td>${s.customer || "Walk-in"}</td>
            <td>${(s.items && s.items.length) || 0}</td>
            <td>${formatCurrency(s.total || 0)}</td>
          `;
                    recentSalesBody.appendChild(tr);
                });
            }

            const labels = [];
            const dataSales = [];

            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const label = d.toLocaleDateString(undefined, { day: '2-digit', month: 'short' });
                labels.push(label);

                const sumForDay = sales
                    .filter(s => new Date(s.date).toDateString() === d.toDateString())
                    .reduce((sum, s) => sum + Number(s.total || 0), 0);

                dataSales.push(sumForDay);
            }

            const ctx = document.getElementById('salesChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'Sales (â‚¹)',
                        data: dataSales
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function (ctx) {
                                    return 'â‚¹' + Number(ctx.parsed.y).toFixed(2);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        initDashboard();

        document.addEventListener('DOMContentLoaded', function () {
            const current = location.pathname.split('/').pop() || 'dashboard.html';
            document.querySelectorAll('.nav a').forEach(link => {
                if (link.getAttribute('href') === current) {
                    link.classList.add('active');
                }
            });
        });
    </script>
</body>

</html>